<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JYZ_OS :: PRO MAX</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-dim: #757575;
            --accent: #4ec9b0;
            --danger: #ff5f56;
            --break: #ffbd2e;
            --garden: #98c379;
            --gold: #e5c07b;
            --shop: #61afef;
            --rare: #c678dd;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Fira Code', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Toast Notification */
        .toast-container { position: fixed; top: 20px; z-index: 1000; pointer-events: none; }
        .toast {
            background: rgba(30, 30, 30, 0.95); border: 1px solid var(--accent); color: var(--accent);
            padding: 10px 20px; border-radius: 4px; margin-bottom: 10px; font-size: 12px;
            display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            animation: slideDown 0.5s forwards, fadeOut 0.5s 4s forwards;
        }
        .toast.gold { border-color: var(--gold); color: var(--gold); }
        .toast.rare { border-color: var(--rare); color: var(--rare); }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }

        /* Nav Bar */
        .nav-bar { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .nav-btn {
            background: none; border: none; color: var(--text-dim); cursor: pointer;
            font-family: 'Fira Code', monospace; font-size: 12px; padding-bottom: 5px;
            border-bottom: 2px solid transparent; transition: 0.3s;
        }
        .nav-btn:hover { color: #fff; }
        .nav-btn.active { color: var(--text-main); border-bottom-color: var(--accent); }
        .nav-btn.gold.active { color: var(--gold); border-bottom-color: var(--gold); }
        .nav-btn.shop.active { color: var(--shop); border-bottom-color: var(--shop); }

        /* Workspace */
        .workspace { display: flex; align-items: flex-end; justify-content: center; gap: 15px; margin-bottom: 30px; width: 100%; }
        #face { font-size: 42px; height: 50px; line-height: 50px; cursor: pointer; white-space: nowrap; flex-shrink: 0; transition: all 0.5s; }
        .monitor {
            width: 120px; height: 80px; background: #000; border: 3px solid #333;
            border-bottom: 6px solid #333; border-radius: 4px; position: relative; overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); transform: perspective(500px) rotateY(-5deg); flex-shrink: 0;
        }
        .screen-content { padding: 4px; font-size: 8px; color: var(--accent); opacity: 0.8; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; text-align: left; line-height: 1.2;}
        .bubble { min-height: 20px; color: var(--accent); font-size: 14px; margin-bottom: 10px; opacity: 0; transition: opacity 0.5s; }
        .bubble.show { opacity: 1; }

        .page { display: none; width: 100%; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Garden */
        .header-stats { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-dim); margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .currency { color: var(--garden); font-weight: bold; }
        .garden-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .plot {
            border: 1px dashed #444; border-radius: 8px; height: 100px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s; position: relative;
        }
        .plot:hover { border-color: var(--garden); background: #1a1f1a; }
        .plant-emoji { font-size: 32px; }
        .plant-bar-bg { width: 80%; height: 3px; background: #333; margin-top: 5px; }
        .plant-bar-fill { height: 100%; background: var(--garden); width: 0%; transition: width 0.2s; }

        /* Store & Trophy Lists */
        .scroll-list { display: grid; grid-template-columns: 1fr; gap: 8px; max-height: 320px; overflow-y: auto; text-align: left; padding-right: 5px;}
        .shop-card, .trophy-card {
            background: #1a1a1a; border: 1px solid #333; padding: 10px; border-radius: 6px;
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
        }
        .shop-info h4 { margin: 0; font-size: 12px; color: var(--shop); }
        .shop-info p { margin: 2px 0 0; font-size: 10px; color: #888; }
        .price-tag { font-size: 11px; color: var(--garden); font-weight: bold; }
        .buy-btn { padding: 4px 8px; font-size: 10px; min-width: 60px; background: #222; border: 1px solid #444; color: #fff; cursor: pointer; border-radius: 4px; }
        .buy-btn:hover { border-color: var(--shop); color: var(--shop); }
        .buy-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #333; color: #555; }
        .owned-tag { font-size: 10px; color: var(--text-dim); border: 1px solid #333; padding: 4px 8px; border-radius: 4px;}

        /* Trophies specific */
        .trophy-card { justify-content: flex-start; opacity: 0.5; filter: grayscale(1); }
        .trophy-card.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--gold); background: rgba(229, 192, 123, 0.1); }
        .trophy-icon { font-size: 20px; min-width: 30px; text-align: center; }
        .trophy-info h4 { color: var(--gold); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        /* Timer UI */
        .timer-display { font-size: 60px; font-weight: 600; margin: 10px 0; }
        .progress-container { width: 100%; height: 4px; background: #333; margin-bottom: 20px; }
        .progress-bar { height: 100%; width: 0%; background: var(--accent); transition: width 1s linear; }
        .controls { display: flex; justify-content: center; gap: 15px; }
        .btn-main { background: var(--card-bg); border: 1px solid #333; color: var(--text-main); padding: 10px 20px; font-family: 'Fira Code', monospace; cursor: pointer; border-radius: 8px; font-size: 13px; transition: 0.2s; }
        .btn-main:hover { border-color: var(--accent); transform: translateY(-2px); }

        .hidden { display: none; }
        .btn-stop:hover { color: var(--danger); border-color: var(--danger); }
        
        @media (max-width: 400px) {
            #face { font-size: 28px; height: 40px; line-height: 40px; }
            .monitor { width: 90px; height: 60px; border-width: 2px; border-bottom-width: 4px; }
        }

    </style>
</head>
<body>

    <div class="toast-container" id="toast-container"></div>

    <div class="container">
        <!-- ÂØºËà™Ê†è -->
        <div class="nav-bar">
            <button class="nav-btn active" id="nav-focus" onclick="switchPage('focus')">_TERMINAL</button>
            <button class="nav-btn" id="nav-garden" onclick="switchPage('garden')">_GARDEN</button>
            <button class="nav-btn shop" id="nav-store" onclick="switchPage('store')">_STORE</button>
            <button class="nav-btn gold" id="nav-trophies" onclick="switchPage('trophies')">_TROPHIES</button>
        </div>

        <div class="workspace">
            <div id="face" onclick="poke()">[ ¬¨ _ ¬¨ ]</div>
            <div class="monitor">
                <div class="screen-content" id="screen-code"><div>_ SYSTEM READY</div></div>
            </div>
        </div>
        <div class="bubble" id="bubble">ÂáÜÂ§áÂ•Ω‰∫ÜÂêóÔºü</div>

        <!-- 1. Áï™ËåÑÈíü -->
        <div id="page-focus" class="page active">
            <div class="timer-display" id="timer">25:00</div>
            <div class="progress-container"><div class="progress-bar" id="progress"></div></div>
            <div class="controls">
                <button class="btn-main" id="btn-start" onclick="startFocus()">[ START ]</button>
                <button class="btn-main hidden" id="btn-break" onclick="startBreak()">[ BREAK ]</button>
                <button class="btn-main hidden btn-stop" id="btn-stop" onclick="stopTimer()">[ STOP ]</button>
            </div>
        </div>

        <!-- 2. ÂÜúÂú∫ -->
        <div id="page-garden" class="page">
            <div class="header-stats">
                <span>DISK: /dev/sdb1</span>
                <span class="currency">WALLET: <span id="byte-count-garden">0</span> B</span>
            </div>
            <div class="garden-grid">
                <div class="plot" id="plot-0" onclick="handlePlot(0)"></div>
                <div class="plot" id="plot-1" onclick="handlePlot(1)"></div>
                <div class="plot" id="plot-2" onclick="handlePlot(2)"></div>
            </div>
            <div style="font-size: 10px; color: #555;">[TIP] ÁßçÊ§ç -> Âä†ÈÄü -> Êî∂Ëé∑ (Â∞èÂøÉË¢´ÂÅ∑)</div>
        </div>

        <!-- 3. ÂïÜÂ∫ó -->
        <div id="page-store" class="page">
            <div class="header-stats">
                <span style="color:var(--shop)">JYZ_MARKETPLACE</span>
                <span class="currency">BAL: <span id="byte-count-store">0</span> B</span>
            </div>
            <div class="scroll-list" id="shop-list"></div>
        </div>

        <!-- 4. ÊàêÂ∞± -->
        <div id="page-trophies" class="page">
            <div class="scroll-list" id="trophy-list"></div>
        </div>
    </div>

    <script>
        // === SAVE SYSTEM ===
        let bytes = parseInt(localStorage.getItem('jyz_bytes')) || 0;
        let stats = JSON.parse(localStorage.getItem('jyz_stats')) || { pokes:0, harvests:0, stolen:0, focus_sessions:0, rare_finds:0, items_bought:0 };
        let unlocked = JSON.parse(localStorage.getItem('jyz_unlocked')) || [];
        let inventory = JSON.parse(localStorage.getItem('jyz_inventory')) || [];
        let equippedSkin = localStorage.getItem('jyz_skin') || null;

        function saveData() {
            localStorage.setItem('jyz_bytes', bytes);
            localStorage.setItem('jyz_stats', JSON.stringify(stats));
            localStorage.setItem('jyz_unlocked', JSON.stringify(unlocked));
            localStorage.setItem('jyz_inventory', JSON.stringify(inventory));
            localStorage.setItem('jyz_skin', equippedSkin);
            updateWalletDisplay();
        }
        function updateWalletDisplay() {
            document.getElementById('byte-count-garden').innerText = bytes;
            document.getElementById('byte-count-store').innerText = bytes;
        }

        // === SHOP DATA ===
        const shopItems = [
            // Consumables
            { id: 'milk', name: 'ËçâËéìÁâõÂ•∂', icon: 'üçì', price: 100, type: 'consumable', desc: 'ÊÅ¢Â§çSANÂÄºÔºåÂ¢ûÂä†Â•ΩÊÑü', single: true },
            { id: 'coffee', name: 'ÂÜ∞ÁæéÂºè', icon: '‚òï', price: 150, type: 'consumable', desc: 'ÁÜ¨Â§úÂøÖÂ§áÔºåÊ±üÂ•ïÊ≥ΩÂñúÊ¨¢', single: true },
            { id: 'cola', name: 'Âø´‰πêÊ∞¥', icon: 'ü•§', price: 80, type: 'consumable', desc: 'È´òÁ≥ñÂàÜÔºåÈ´òÂø´‰πê', single: true },
            { id: 'ram', name: 'ÂÜÖÂ≠òÊ∏ÖÁêÜ', icon: 'üßπ', price: 200, type: 'consumable', desc: 'ÂøÉÊÉÖÂèòÂ•ΩÔºåÂáèÂ∞ëbug', single: true },
            
            // Skins
            { id: 'cat_ears', name: 'Áå´ËÄ≥Â•≥‰ªÜ', icon: 'üéÄ', price: 800, type: 'skin', desc: 'ÊÅ∂Ë∂£Âë≥ÂèëÁÆçÔºå‰ªñ‰ºöËÑ∏Á∫¢', skinFace: "( /// _ /// )" },
            { id: 'glasses_gold', name: 'Èáë‰∏ùÁúºÈïú', icon: 'üëì', price: 1000, type: 'skin', desc: 'ÊñØÊñáË¥•Á±ªÈôêÂÆö', skinFace: "[ üëì _ üëì ]" },
            { id: 'vr_set', name: 'VRÂ§¥Êòæ', icon: 'ü•Ω', price: 1500, type: 'skin', desc: 'ÂÆåÂÖ®Ê≤âÊµ∏Ê®°Âºè', skinFace: "[ ‚¨õ _ ‚¨õ ]" },
            { id: 'mask', name: 'ÈªëÂÆ¢Èù¢ÁΩ©', icon: 'üò∑', price: 2000, type: 'skin', desc: 'ÂåøÂêçËÄÖÈ£éÊ†º', skinFace: "{ - _ - }" },
            
            // Upgrades
            { id: 'speed_core', name: 'Ë∂ÖÈ¢ëÊ†∏ÂøÉ', icon: '‚ö°', price: 1200, type: 'upgrade', desc: '[Ë¢´Âä®] ÂÜúÂú∫ÁîüÈïøÈÄüÂ∫¶ +20%' },
            { id: 'firewall', name: 'Èò≤ÁÅ´Â¢ô 2.0', icon: 'üõ°Ô∏è', price: 1800, type: 'upgrade', desc: '[Ë¢´Âä®] Ë¢´ÂÅ∑ËèúÊ¶ÇÁéáÂ§ßÂπÖÈôç‰Ωé' },
            { id: 'auto_script', name: 'Ëá™Âä®ÁÅåÊ∫â', icon: 'ü§ñ', price: 3000, type: 'upgrade', desc: '[Ë¢´Âä®] Âç≥‰Ωø‰∏çÁÇπÂáª‰πü‰ºöËá™Âä®ÁîüÈïø' },
            { id: 'lucky_bit', name: 'Âπ∏Ëøê‰ΩçÂÖÉ', icon: 'üçÄ', price: 5000, type: 'upgrade', desc: '[Ë¢´Âä®] Á®ÄÊúâÊ§çÁâ©Âá∫Áé∞ÁéáÁøªÂÄç' }
        ];

        // === BASE FACES ===
        const baseFaces = {
            idle: "[ ¬¨ _ ¬¨ ]", focus: "[ ‚å®Ô∏è _ ‚å®Ô∏è ]", garden: "[ ‚òòÔ∏è _ ‚òòÔ∏è ]", 
            happy: "[ ¬¨ ‚Äø ¬¨ ]", shock: "/ > _ < /", eat: "[ Ôø£ ÔΩû Ôø£ ]", 
            trophy: "[ üèÜ _ üèÜ ]", shop: "[ $ _ $ ]", blush: "[ // _ // ]",
            angry: "[ ‡≤† _ ‡≤† ]"
        };
        const face = document.getElementById('face');
        const bubble = document.getElementById('bubble');
        const screenCode = document.getElementById('screen-code');

        // === PLANTS ===
        const plants = [
            { name: "BinaryBamboo", icon: "üéç", time: 40, reward: 20, weight: 1.0 },
            { name: "CodeTree",     icon: "üå≤", time: 80, reward: 50, weight: 0.8 },
            { name: "PixelFlower",  icon: "üåª", time: 60, reward: 35, weight: 0.9 },
            { name: "DataShroom",   icon: "üçÑ", time: 70, reward: 40, weight: 0.8 },
            { name: "LogicRose",    icon: "üåπ", time: 120, reward: 100, weight: 0.5 },
            { name: "QuantumLotus", icon: "ü™∑", time: 200, reward: 250, rare: true, weight: 0.1 },
            { name: "FirewallApple",icon: "üçé", time: 90, reward: 60, weight: 0.6 },
            { name: "EtherCrystal", icon: "üíé", time: 150, reward: 150, rare: true, weight: 0.2 }
        ];

        // === ACHIEVEMENTS ===
        const achievements = [
            { id: 'first_blood', icon: 'üå±', title: 'Hello World', desc: 'Êî∂Ëé∑ 1 Ê¨°Ê§çÁâ©', check: () => stats.harvests >= 1 },
            { id: 'rich', icon: 'üí∞', title: 'Data Tycoon', desc: 'ÊåÅÊúâ 1000 Bytes', check: () => bytes >= 1000 },
            { id: 'whale', icon: 'üè¶', title: 'Data Whale', desc: 'ÊåÅÊúâ 5000 Bytes', check: () => bytes >= 5000 },
            { id: 'victim', icon: 'üí¢', title: 'Server Tax', desc: 'Ë¢´ÂÅ∑Ëèú 3 Ê¨°', check: () => stats.stolen >= 3 },
            { id: 'stockholm', icon: '‚ù§Ô∏è', title: 'Stockholm', desc: 'Ë¢´ÂÅ∑Ëèú 10 Ê¨°', check: () => stats.stolen >= 10 },
            { id: 'spender', icon: 'üí≥', title: 'Consumer', desc: 'Ë¥≠‰π∞ 1 ‰ª∂ÂïÜÂìÅ', check: () => inventory.length >= 1 },
            { id: 'shopaholic', icon: 'üõçÔ∏è', title: 'Shopaholic', desc: 'Ë¥≠‰π∞ 5 ‰ª∂ÂïÜÂìÅ', check: () => stats.items_bought >= 5 },
            { id: 'fashion', icon: 'üëó', title: 'Cosplayer', desc: 'Ë£ÖÂ§á‰∏ÄÊ¨æÁöÆËÇ§', check: () => equippedSkin !== null },
            { id: 'maid_fetish', icon: 'üéÄ', title: 'Bad Taste', desc: 'Âº∫Âà∂‰ªñÁ©øÂ•≥‰ªÜË£Ö', check: () => equippedSkin === 'cat_ears' },
            { id: 'annoying', icon: 'üëÜ', title: 'DDOS Attack', desc: 'Êà≥‰ªñ 50 Ê¨°', check: () => stats.pokes >= 50 },
            { id: 'lucky', icon: 'üçÄ', title: 'RNG God', desc: 'Ëé∑ÂæóÁ®ÄÊúâÊ§çÁâ©', check: () => stats.rare_finds >= 1 },
            // üü¢ ‰øÆÊîπÁÇπÔºöËøôÈáåÊîπÊàê‰∫Ü 1 Ê¨°
            { id: 'focus_god', icon: 'üçÖ', title: 'First Step', desc: 'ÂÆåÊàê 1 Ê¨°‰∏ìÊ≥®', check: () => stats.focus_sessions >= 1 }
        ];

        // === SHOP LOGIC ===
        function renderShop() {
            const list = document.getElementById('shop-list'); list.innerHTML = '';
            shopItems.forEach(item => {
                const owned = inventory.includes(item.id);
                const canBuy = item.type === 'consumable' || !owned;
                const isEquipped = equippedSkin === item.id;
                let btnHtml = '';
                if (item.type === 'skin' && owned) {
                    btnHtml = `<button class="buy-btn" onclick="equipItem('${item.id}')" style="border-color:var(--accent); color:var(--accent)">${isEquipped ? 'ON' : 'WEAR'}</button>`;
                } else if (!canBuy) {
                    btnHtml = `<div class="owned-tag">OWNED</div>`;
                } else {
                    btnHtml = `<button class="buy-btn" onclick="buyItem('${item.id}')" ${bytes < item.price ? 'disabled' : ''}>BUY</button>`;
                }
                list.innerHTML += `<div class="shop-card"><div class="shop-info"><div style="display:flex; align-items:center; gap:5px;"><span style="font-size:18px">${item.icon}</span><h4>${item.name}</h4></div><p>${item.desc}</p></div><div style="text-align:right"><div class="price-tag">${item.price} B</div>${btnHtml}</div></div>`;
            });
        }

        function buyItem(id) {
            const item = shopItems.find(i => i.id === id);
            if (bytes >= item.price) {
                bytes -= item.price;
                stats.items_bought++;
                if (item.type === 'consumable') {
                    if(item.id === 'milk') { face.innerText = baseFaces.eat; say("ÂãâÂº∫Âñù‰∏ÄÂè£...Ë∞¢‰∫Ü„ÄÇ"); }
                    if(item.id === 'coffee') { face.innerText = "[ ‚óâ _ ‚óâ ]"; say("Á≤æÁ•ûÊù•‰∫Ü„ÄÇ"); }
                    if(item.id === 'cola') { face.innerText = baseFaces.happy; say("È´òÁ≥ñÂàÜË≠¶Âëä„ÄÇ"); }
                    if(item.id === 'ram') { face.innerText = baseFaces.idle; say("Ê∏ÖÁêÜÂÆåÊØïÔºåÂøÉÊÉÖËàíÁïÖ„ÄÇ"); }
                } else {
                    inventory.push(id);
                    showToast('PURCHASE SUCCESS', `Ëé∑Âæó: ${item.name}`, 'var(--shop)');
                    if(item.type === 'upgrade') say("Á≥ªÁªüÂçáÁ∫ß‰∏≠...");
                }
                saveData(); renderShop(); checkAchievements();
            } else { say("‰ΩôÈ¢ù‰∏çË∂≥„ÄÇ"); }
        }

        function equipItem(id) {
            if (equippedSkin === id) { equippedSkin = null; say("Áªà‰∫éÂèØ‰ª•Êëò‰∏ãÊù•‰∫Ü..."); } 
            else { 
                equippedSkin = id; 
                if(id === 'cat_ears') say("ËøôÁßçÊÅ∂Ë∂£Âë≥...‰∏ã‰∏ç‰∏∫‰æã„ÄÇ");
                if(id === 'vr_set') say("ËøõÂÖ•Ê∑±ÊΩúÊ®°Âºè„ÄÇ");
                if(id === 'mask') say("We are legion.");
            }
            saveData(); renderShop(); updateFace(); checkAchievements();
        }

        function getFace(state) {
            if (equippedSkin && state === 'idle') {
                const skin = shopItems.find(i => i.id === equippedSkin);
                return skin ? skin.skinFace : baseFaces.idle;
            }
            return baseFaces[state];
        }

        function updateFace() {
            const page = document.querySelector('.nav-btn.active').id.split('-')[1];
            let state = 'idle';
            if (page === 'focus') state = 'idle';
            if (page === 'garden') state = 'garden';
            if (page === 'store') state = 'shop';
            if (page === 'trophies') state = 'trophy';
            face.innerText = getFace(state);
        }

        // === FARM LOGIC ===
        const plots = [ {state:0, progress:0}, {state:0, progress:0}, {state:0, progress:0} ];

        function getRandomPlant() {
            let isLucky = inventory.includes('lucky_bit');
            let pool = [];
            plants.forEach(p => {
                let w = p.weight;
                if(p.rare && isLucky) w *= 2;
                for(let i=0; i<w*10; i++) pool.push(p);
            });
            return pool[Math.floor(Math.random() * pool.length)];
        }

        function handlePlot(index) {
            const plot = plots[index];
            const el = document.getElementById(`plot-${index}`);
            if (plot.state === 0) {
                plot.state = 1; plot.progress = 0; plot.type = getRandomPlant();
                say(`ÂÜôÂÖ• ${plot.type.name}...`); renderPlot(index);
                let intervalTime = inventory.includes('auto_script') ? 50 : 100;
                plot.timer = setInterval(() => grow(index), intervalTime); 
            } else if (plot.state === 1) {
                plot.progress += 8;
                createFloatingText(el, "+SPEED", "#fff");
                if (plot.progress >= 100) { plot.progress = 100; plot.state = 2; clearInterval(plot.timer); }
                renderPlot(index);
            } else if (plot.state === 2) {
                let stealChance = inventory.includes('firewall') ? 0.10 : 0.25;
                if (Math.random() < stealChance) {
                    face.innerText = baseFaces.happy; say("ÂæÅÁî®‰∫Ü„ÄÇ"); createFloatingText(el, "STOLEN!", "#ff5f56"); stats.stolen++;
                } else {
                    bytes += plot.type.reward; stats.harvests++;
                    if(plot.type.rare) { stats.rare_finds++; showToast('RARE FIND!', `Found ${plot.type.name}`, 'var(--rare)', false); }
                    say(`ÂõûÊî∂: +${plot.type.reward}B`); createFloatingText(el, `+${plot.type.reward}B`, "#98c379");
                }
                checkAchievements(); plot.state = 0; plot.progress = 0; plot.type = null; renderPlot(index); saveData();
            }
        }

        function grow(index) {
            const plot = plots[index];
            if (plot.state === 1) {
                let speedMult = inventory.includes('speed_core') ? 1.5 : 1.0;
                let autoGrow = inventory.includes('auto_script') ? 0.2 : 0; 
                plot.progress += (100 / (plot.type.time * 2)) * speedMult + autoGrow;
                if (plot.progress >= 100) { plot.progress = 100; plot.state = 2; clearInterval(plot.timer); }
                renderPlot(index);
            }
        }

        function renderPlot(index) {
            const plot = plots[index];
            const el = document.getElementById(`plot-${index}`);
            if (plot.state === 0) { el.innerHTML = `<div class="plant-emoji">üî≤</div><div class="plant-status">EMPTY</div>`; el.style.borderColor = "#444"; }
            else if (plot.state === 1) { el.innerHTML = `<div class="plant-emoji">üå±</div><div class="plant-name">${plot.type.name}</div><div class="plant-bar-bg"><div class="plant-bar-fill" style="width:${plot.progress}%"></div></div>`; el.style.borderColor = "var(--garden)"; }
            else if (plot.state === 2) { el.innerHTML = `<div class="plant-emoji">${plot.type.icon}</div><div class="plant-name" style="color:#fff">READY</div>`; el.style.borderColor = "#fff"; }
        }

        // === UTILS & UI ===
        function checkAchievements() {
            let newUnlock = false;
            achievements.forEach(ach => {
                if (!unlocked.includes(ach.id) && ach.check()) { unlockAchievement(ach); newUnlock = true; }
            });
            if(newUnlock) saveData();
        }
        function unlockAchievement(ach) {
            unlocked.push(ach.id); showToast('ACHIEVEMENT UNLOCKED', ach.title, 'var(--gold)', true);
        }
        function showToast(title, msg, color, isGold) {
            const toast = document.createElement('div'); toast.className = 'toast'; if(isGold) toast.classList.add('gold');
            toast.style.borderColor = color; toast.style.color = color;
            toast.innerHTML = `<div><div style="font-weight:bold">${title}</div><div>${msg}</div></div>`;
            document.getElementById('toast-container').appendChild(toast); setTimeout(() => toast.remove(), 4500);
        }
        function createFloatingText(parent, text, color) {
            const el = document.createElement('div'); el.innerText = text; el.style.position = 'absolute'; el.style.color = color;
            el.style.fontWeight = 'bold'; el.style.fontSize = '12px'; el.style.pointerEvents = 'none';
            el.style.top = '50%'; el.style.left = '50%'; el.style.zIndex = '10'; el.style.textShadow = '0 1px 2px #000';
            el.style.transform = 'translate(-50%, -50%)'; el.style.animation = 'floatUp 0.8s forwards';
            parent.appendChild(el); setTimeout(() => el.remove(), 800);
        }
        const style = document.createElement('style'); style.innerHTML = `@keyframes floatUp { 0% { transform: translate(-50%, -50%); opacity: 1; } 100% { transform: translate(-50%, -150%); opacity: 0; } }`; document.head.appendChild(style);

        function renderTrophies() {
            const list = document.getElementById('trophy-list'); list.innerHTML = '';
            achievements.forEach(ach => {
                const isUnlocked = unlocked.includes(ach.id);
                list.innerHTML += `<div class="trophy-card ${isUnlocked?'unlocked':''}"><div class="trophy-icon">${isUnlocked?ach.icon:'üîí'}</div><div class="shop-info"><h4>${ach.title}</h4><p>${isUnlocked?ach.desc:'???'}</p></div></div>`;
            });
        }

        function switchPage(page) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');
            document.getElementById(`nav-${page}`).classList.add('active');
            updateFace();
            if(page === 'store') { renderShop(); say("Âà´‰π±Ëä±Èí±„ÄÇ"); updateScreen('shop'); }
            else if (page === 'garden') { say("ÂéªÊî∂Ëèú„ÄÇ"); updateScreen('garden'); }
            else if (page === 'trophies') { renderTrophies(); updateScreen('idle'); }
            else updateScreen('idle');
        }
        function say(text) { bubble.innerText = text; bubble.classList.add('show'); setTimeout(() => bubble.classList.remove('show'), 3000); }
        let screenInterval;
        function updateScreen(mode) {
            clearInterval(screenInterval); screenCode.innerHTML = '';
            if (mode === 'garden') { screenCode.style.color = 'var(--garden)'; screenCode.innerHTML = '<div>_ GARDEN_MODE</div>'; screenInterval = setInterval(() => { if(Math.random()>0.7) screenCode.innerHTML += `<div>> grow...</div>`; if(screenCode.children.length>5) screenCode.removeChild(screenCode.firstChild); }, 500); }
            else if (mode === 'shop') { screenCode.style.color = 'var(--shop)'; screenCode.innerHTML = '<div>_ MARKETPLACE</div>'; }
            else { screenCode.style.color = 'var(--accent)'; screenCode.innerHTML = '<div>_ READY</div>'; }
        }
        let timeLeft = 1500; let timerId = null;
        function startFocus() {
            document.getElementById('btn-start').classList.add('hidden'); document.getElementById('btn-stop').classList.remove('hidden');
            face.innerText = baseFaces.focus; say("Lock & Load.");
            timerId = setInterval(() => {
                timeLeft--; document.getElementById('timer').innerText = `${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}`;
                document.getElementById('progress').style.width = `${((1500-timeLeft)/1500)*100}%`;
                if(timeLeft<=0) { clearInterval(timerId); stats.focus_sessions++; saveData(); checkAchievements(); stopTimer(); }
            }, 1000);
        }
        function stopTimer() { clearInterval(timerId); timeLeft = 1500; document.getElementById('timer').innerText = "25:00"; document.getElementById('progress').style.width = "0%"; document.getElementById('btn-start').classList.remove('hidden'); document.getElementById('btn-stop').classList.add('hidden'); updateFace(); }
        function poke() {
            stats.pokes++; checkAchievements();
            if(Math.random()>0.5) { face.innerText = baseFaces.shock; say("Âà´Êà≥ÔºÅ"); } else say("...");
            setTimeout(updateFace, 1000);
        }

        // Init
        updateWalletDisplay(); updateFace();
    </script>
</body>
</html>